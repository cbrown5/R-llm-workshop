<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 9 Automated workflows with Agent mode | Quality R analysis with large language models</title>
  <meta name="description" content="1-day workshop for using large language models to generate R code." />
  <meta name="generator" content="bookdown 0.43 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 9 Automated workflows with Agent mode | Quality R analysis with large language models" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="1-day workshop for using large language models to generate R code." />
  <meta name="github-repo" content="cbrown5/R-llm-workshop" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 9 Automated workflows with Agent mode | Quality R analysis with large language models" />
  
  <meta name="twitter:description" content="1-day workshop for using large language models to generate R code." />
  

<meta name="author" content="CJ Brown (c.j.brown@utas.edu.au)" />


<meta name="date" content="2025-06-26" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="creating-your-code-with-edit-mode.html"/>
<link rel="next" href="ethics-and-copyright.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Quality R analysis with large language models</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Quality R analysis with large language models</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#summary"><i class="fa fa-check"></i><b>1.1</b> Summary</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#about-chris"><i class="fa fa-check"></i><b>1.2</b> About Chris</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#citation-for-course"><i class="fa fa-check"></i><b>1.3</b> Citation for course</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#course-outline"><i class="fa fa-check"></i><b>1.4</b> Course outline</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#software-youll-need-for-this-workshop"><i class="fa fa-check"></i><b>1.5</b> Software you’ll need for this workshop</a>
<ul>
<li class="chapter" data-level="1.5.1" data-path="index.html"><a href="index.html#optional-software"><i class="fa fa-check"></i><b>1.5.1</b> Optional software</a></li>
</ul></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#software-licenses"><i class="fa fa-check"></i><b>1.6</b> Software licenses</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#r-packages-youll-need-for-this-workshop"><i class="fa fa-check"></i><b>1.7</b> R packages you’ll need for this workshop</a></li>
<li class="chapter" data-level="1.8" data-path="index.html"><a href="index.html#data"><i class="fa fa-check"></i><b>1.8</b> Data</a>
<ul>
<li class="chapter" data-level="1.8.1" data-path="index.html"><a href="index.html#benthic-cover-surveys-and-fish-habitat"><i class="fa fa-check"></i><b>1.8.1</b> Benthic cover surveys and fish habitat</a></li>
<li class="chapter" data-level="1.8.2" data-path="index.html"><a href="index.html#rock-lobster-time-series"><i class="fa fa-check"></i><b>1.8.2</b> Rock lobster time-series</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="introduction-to-llms-for-r.html"><a href="introduction-to-llms-for-r.html"><i class="fa fa-check"></i><b>2</b> Introduction to LLMs for R</a></li>
<li class="chapter" data-level="3" data-path="llm-prompting-fundamentals.html"><a href="llm-prompting-fundamentals.html"><i class="fa fa-check"></i><b>3</b> LLM prompting fundamentals</a>
<ul>
<li class="chapter" data-level="3.1" data-path="llm-prompting-fundamentals.html"><a href="llm-prompting-fundamentals.html#setup-authorisation"><i class="fa fa-check"></i><b>3.1</b> Setup authorisation</a></li>
<li class="chapter" data-level="3.2" data-path="llm-prompting-fundamentals.html"><a href="llm-prompting-fundamentals.html#understanding-how-llms-work"><i class="fa fa-check"></i><b>3.2</b> Understanding how LLMs work</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="llm-prompting-fundamentals.html"><a href="llm-prompting-fundamentals.html#token-by-token-prediction"><i class="fa fa-check"></i><b>3.2.1</b> Token-by-token prediction</a></li>
<li class="chapter" data-level="3.2.2" data-path="llm-prompting-fundamentals.html"><a href="llm-prompting-fundamentals.html#temperature-effects"><i class="fa fa-check"></i><b>3.2.2</b> Temperature effects</a></li>
<li class="chapter" data-level="3.2.3" data-path="llm-prompting-fundamentals.html"><a href="llm-prompting-fundamentals.html#comparing-model-complexity"><i class="fa fa-check"></i><b>3.2.3</b> Comparing model complexity</a></li>
<li class="chapter" data-level="3.2.4" data-path="llm-prompting-fundamentals.html"><a href="llm-prompting-fundamentals.html#understanding-context-windows"><i class="fa fa-check"></i><b>3.2.4</b> Understanding context windows</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="llm-prompting-fundamentals.html"><a href="llm-prompting-fundamentals.html#diy-stats-bot"><i class="fa fa-check"></i><b>3.3</b> DIY stats bot</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="llm-prompting-fundamentals.html"><a href="llm-prompting-fundamentals.html#improving-the-stats-bot"><i class="fa fa-check"></i><b>3.3.1</b> Improving the stats bot</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="llm-prompting-fundamentals.html"><a href="llm-prompting-fundamentals.html#advanced-prompting"><i class="fa fa-check"></i><b>3.4</b> Advanced prompting</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="llm-prompting-fundamentals.html"><a href="llm-prompting-fundamentals.html#zero-shot"><i class="fa fa-check"></i><b>3.4.1</b> Zero-shot</a></li>
<li class="chapter" data-level="3.4.2" data-path="llm-prompting-fundamentals.html"><a href="llm-prompting-fundamentals.html#one-shot-and-multi-shot-prompts"><i class="fa fa-check"></i><b>3.4.2</b> One-shot and multi-shot prompts</a></li>
<li class="chapter" data-level="3.4.3" data-path="llm-prompting-fundamentals.html"><a href="llm-prompting-fundamentals.html#making-a-simple-tool"><i class="fa fa-check"></i><b>3.4.3</b> Making a simple tool</a></li>
<li class="chapter" data-level="3.4.4" data-path="llm-prompting-fundamentals.html"><a href="llm-prompting-fundamentals.html#summary-of-agents-and-tools"><i class="fa fa-check"></i><b>3.4.4</b> Summary of agents and tools</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="llm-prompting-fundamentals.html"><a href="llm-prompting-fundamentals.html#reflection-on-prompting-fundamentals"><i class="fa fa-check"></i><b>3.5</b> Reflection on prompting fundamentals</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="github-copilot-for-r.html"><a href="github-copilot-for-r.html"><i class="fa fa-check"></i><b>4</b> Github copilot for R</a></li>
<li class="chapter" data-level="5" data-path="best-practices-project-setup.html"><a href="best-practices-project-setup.html"><i class="fa fa-check"></i><b>5</b> Best practices project setup</a>
<ul>
<li class="chapter" data-level="5.1" data-path="best-practices-project-setup.html"><a href="best-practices-project-setup.html#project-organization"><i class="fa fa-check"></i><b>5.1</b> Project organization</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="best-practices-project-setup.html"><a href="best-practices-project-setup.html#general-guidance"><i class="fa fa-check"></i><b>5.1.1</b> General guidance</a></li>
<li class="chapter" data-level="5.1.2" data-path="best-practices-project-setup.html"><a href="best-practices-project-setup.html#project-directory-structure-example"><i class="fa fa-check"></i><b>5.1.2</b> Project directory structure example</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="best-practices-project-setup.html"><a href="best-practices-project-setup.html#the-readme.md-file"><i class="fa fa-check"></i><b>5.2</b> The README.md file</a></li>
<li class="chapter" data-level="5.3" data-path="best-practices-project-setup.html"><a href="best-practices-project-setup.html#example-data"><i class="fa fa-check"></i><b>5.3</b> Example data</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="best-practices-project-setup.html"><a href="best-practices-project-setup.html#case-study-bumphead-parrotfish-topa-in-solomon-islands"><i class="fa fa-check"></i><b>5.3.1</b> Case-study: Bumphead parrotfish, ‘Topa’ in Solomon Islands</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="inline-code-editing.html"><a href="inline-code-editing.html"><i class="fa fa-check"></i><b>6</b> Inline code editing</a>
<ul>
<li class="chapter" data-level="6.1" data-path="inline-code-editing.html"><a href="inline-code-editing.html#code-completion"><i class="fa fa-check"></i><b>6.1</b> 1. Code completion</a></li>
<li class="chapter" data-level="6.2" data-path="inline-code-editing.html"><a href="inline-code-editing.html#using-comments"><i class="fa fa-check"></i><b>6.2</b> 2. Using comments</a></li>
<li class="chapter" data-level="6.3" data-path="inline-code-editing.html"><a href="inline-code-editing.html#code-completion-settings"><i class="fa fa-check"></i><b>6.3</b> 3. Code completion settings</a></li>
<li class="chapter" data-level="6.4" data-path="inline-code-editing.html"><a href="inline-code-editing.html#inline-code-generation"><i class="fa fa-check"></i><b>6.4</b> 4. Inline code generation</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="inline-code-editing.html"><a href="inline-code-editing.html#prompt-shortcuts"><i class="fa fa-check"></i><b>6.4.1</b> Prompt shortcuts</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="planning-your-analysis-with-ask-mode.html"><a href="planning-your-analysis-with-ask-mode.html"><i class="fa fa-check"></i><b>7</b> Planning your analysis with Ask mode</a>
<ul>
<li class="chapter" data-level="7.1" data-path="planning-your-analysis-with-ask-mode.html"><a href="planning-your-analysis-with-ask-mode.html#stages-of-analysis"><i class="fa fa-check"></i><b>7.1</b> Stages of analysis</a></li>
<li class="chapter" data-level="7.2" data-path="planning-your-analysis-with-ask-mode.html"><a href="planning-your-analysis-with-ask-mode.html#ask-mode"><i class="fa fa-check"></i><b>7.2</b> Ask mode</a></li>
<li class="chapter" data-level="7.3" data-path="planning-your-analysis-with-ask-mode.html"><a href="planning-your-analysis-with-ask-mode.html#the-jagged-frontier-of-llm-progress"><i class="fa fa-check"></i><b>7.3</b> The jagged frontier of LLM progress</a></li>
<li class="chapter" data-level="7.4" data-path="planning-your-analysis-with-ask-mode.html"><a href="planning-your-analysis-with-ask-mode.html#how-to-prompt-for-better-statistical-advice"><i class="fa fa-check"></i><b>7.4</b> How to prompt for better statistical advice</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="planning-your-analysis-with-ask-mode.html"><a href="planning-your-analysis-with-ask-mode.html#what-llms-dont-do-that-real-statisticians-do"><i class="fa fa-check"></i><b>7.4.1</b> What LLMs don’t do that real statisticians do…</a></li>
<li class="chapter" data-level="7.4.2" data-path="planning-your-analysis-with-ask-mode.html"><a href="planning-your-analysis-with-ask-mode.html#guidelines-for-prompting-for-statistical-advice"><i class="fa fa-check"></i><b>7.4.2</b> Guidelines for prompting for statistical advice</a></li>
<li class="chapter" data-level="7.4.3" data-path="planning-your-analysis-with-ask-mode.html"><a href="planning-your-analysis-with-ask-mode.html#improving-our-initial-prompt-by-attaching-data"><i class="fa fa-check"></i><b>7.4.3</b> Improving our initial prompt by attaching data</a></li>
<li class="chapter" data-level="7.4.4" data-path="planning-your-analysis-with-ask-mode.html"><a href="planning-your-analysis-with-ask-mode.html#improving-our-initial-prompt-by-attaching-domain-knowledge"><i class="fa fa-check"></i><b>7.4.4</b> Improving our initial prompt by attaching domain knowledge</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="planning-your-analysis-with-ask-mode.html"><a href="planning-your-analysis-with-ask-mode.html#planning-implementation"><i class="fa fa-check"></i><b>7.5</b> Planning implementation</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="creating-your-code-with-edit-mode.html"><a href="creating-your-code-with-edit-mode.html"><i class="fa fa-check"></i><b>8</b> Creating your code with Edit mode</a>
<ul>
<li class="chapter" data-level="8.1" data-path="creating-your-code-with-edit-mode.html"><a href="creating-your-code-with-edit-mode.html#adding-a-plan-to-the-readme"><i class="fa fa-check"></i><b>8.1</b> Adding a plan to the readme</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="creating-your-code-with-edit-mode.html"><a href="creating-your-code-with-edit-mode.html#working-through-your-plan"><i class="fa fa-check"></i><b>8.1.1</b> Working through your plan</a></li>
<li class="chapter" data-level="8.1.2" data-path="creating-your-code-with-edit-mode.html"><a href="creating-your-code-with-edit-mode.html#why-so-much-code"><i class="fa fa-check"></i><b>8.1.2</b> Why so much code?</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="creating-your-code-with-edit-mode.html"><a href="creating-your-code-with-edit-mode.html#workflows-and-tips-for-edit-mode"><i class="fa fa-check"></i><b>8.2</b> Workflows and tips for edit mode</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="creating-your-code-with-edit-mode.html"><a href="creating-your-code-with-edit-mode.html#suggested-workflow-for-new-analyses"><i class="fa fa-check"></i><b>8.2.1</b> Suggested workflow for new analyses</a></li>
<li class="chapter" data-level="8.2.2" data-path="creating-your-code-with-edit-mode.html"><a href="creating-your-code-with-edit-mode.html#suggested-workflow-for-analyses-i-know-well"><i class="fa fa-check"></i><b>8.2.2</b> Suggested workflow for analyses I know well</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="automated-workflows-with-agent-mode.html"><a href="automated-workflows-with-agent-mode.html"><i class="fa fa-check"></i><b>9</b> Automated workflows with Agent mode</a>
<ul>
<li class="chapter" data-level="9.1" data-path="automated-workflows-with-agent-mode.html"><a href="automated-workflows-with-agent-mode.html#exploring-agent-mode"><i class="fa fa-check"></i><b>9.1</b> Exploring agent mode</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="automated-workflows-with-agent-mode.html"><a href="automated-workflows-with-agent-mode.html#motivating-example-bayesian-time-series-analysis"><i class="fa fa-check"></i><b>9.1.1</b> Motivating example Bayesian time-series analysis</a></li>
<li class="chapter" data-level="9.1.2" data-path="automated-workflows-with-agent-mode.html"><a href="automated-workflows-with-agent-mode.html#set-up-your-project"><i class="fa fa-check"></i><b>9.1.2</b> Set-up your project</a></li>
<li class="chapter" data-level="9.1.3" data-path="automated-workflows-with-agent-mode.html"><a href="automated-workflows-with-agent-mode.html#prompts-i-used"><i class="fa fa-check"></i><b>9.1.3</b> Prompts I used</a></li>
<li class="chapter" data-level="9.1.4" data-path="automated-workflows-with-agent-mode.html"><a href="automated-workflows-with-agent-mode.html#writing-up-the-project"><i class="fa fa-check"></i><b>9.1.4</b> Writing up the project?</a></li>
<li class="chapter" data-level="9.1.5" data-path="automated-workflows-with-agent-mode.html"><a href="automated-workflows-with-agent-mode.html#custom-intstructions"><i class="fa fa-check"></i><b>9.1.5</b> Custom intstructions</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="automated-workflows-with-agent-mode.html"><a href="automated-workflows-with-agent-mode.html#summary-1"><i class="fa fa-check"></i><b>9.2</b> Summary</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="ethics-and-copyright.html"><a href="ethics-and-copyright.html"><i class="fa fa-check"></i><b>10</b> Ethics and copyright</a>
<ul>
<li class="chapter" data-level="10.1" data-path="ethics-and-copyright.html"><a href="ethics-and-copyright.html#sustainability"><i class="fa fa-check"></i><b>10.1</b> Sustainability</a></li>
<li class="chapter" data-level="10.2" data-path="ethics-and-copyright.html"><a href="ethics-and-copyright.html#model-biases"><i class="fa fa-check"></i><b>10.2</b> Model biases</a></li>
<li class="chapter" data-level="10.3" data-path="ethics-and-copyright.html"><a href="ethics-and-copyright.html#rising-inequality"><i class="fa fa-check"></i><b>10.3</b> Rising inequality</a></li>
<li class="chapter" data-level="10.4" data-path="ethics-and-copyright.html"><a href="ethics-and-copyright.html#copyright"><i class="fa fa-check"></i><b>10.4</b> Copyright</a></li>
<li class="chapter" data-level="10.5" data-path="ethics-and-copyright.html"><a href="ethics-and-copyright.html#managing-data-privacy"><i class="fa fa-check"></i><b>10.5</b> Managing data privacy</a></li>
<li class="chapter" data-level="10.6" data-path="ethics-and-copyright.html"><a href="ethics-and-copyright.html#supplement-calculations-of-personal-environmental-impact-from-using-llms"><i class="fa fa-check"></i><b>10.6</b> Supplement: Calculations of personal environmental impact from using LLMs</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="advanced-llm-agents.html"><a href="advanced-llm-agents.html"><i class="fa fa-check"></i><b>11</b> Advanced LLM agents</a></li>
<li class="chapter" data-level="12" data-path="cost-and-security.html"><a href="cost-and-security.html"><i class="fa fa-check"></i><b>12</b> Cost and security</a>
<ul>
<li class="chapter" data-level="12.1" data-path="cost-and-security.html"><a href="cost-and-security.html#cost-considerations"><i class="fa fa-check"></i><b>12.1</b> Cost considerations</a></li>
<li class="chapter" data-level="12.2" data-path="cost-and-security.html"><a href="cost-and-security.html#api-security"><i class="fa fa-check"></i><b>12.2</b> API security</a></li>
<li class="chapter" data-level="12.3" data-path="cost-and-security.html"><a href="cost-and-security.html#agent-security"><i class="fa fa-check"></i><b>12.3</b> Agent security</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="conclusion.html"><a href="conclusion.html"><i class="fa fa-check"></i><b>13</b> Conclusion</a>
<ul>
<li class="chapter" data-level="13.1" data-path="conclusion.html"><a href="conclusion.html#the-changing-landscape-of-scientific-computing"><i class="fa fa-check"></i><b>13.1</b> The changing landscape of scientific computing</a></li>
<li class="chapter" data-level="13.2" data-path="conclusion.html"><a href="conclusion.html#developing-community-standards"><i class="fa fa-check"></i><b>13.2</b> Developing community standards</a></li>
<li class="chapter" data-level="13.3" data-path="conclusion.html"><a href="conclusion.html#future-directions"><i class="fa fa-check"></i><b>13.3</b> Future directions</a></li>
<li class="chapter" data-level="13.4" data-path="conclusion.html"><a href="conclusion.html#recommendations-for-students-and-ecrs"><i class="fa fa-check"></i><b>13.4</b> Recommendations for students and ECRs</a></li>
<li class="chapter" data-level="13.5" data-path="conclusion.html"><a href="conclusion.html#what-should-supervisors-pis-do"><i class="fa fa-check"></i><b>13.5</b> What should supervisors (PIs) do?</a></li>
<li class="chapter" data-level="13.6" data-path="conclusion.html"><a href="conclusion.html#everyone"><i class="fa fa-check"></i><b>13.6</b> Everyone</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Quality R analysis with large language models</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="automated-workflows-with-agent-mode" class="section level1 hasAnchor" number="9">
<h1><span class="header-section-number">Chapter 9</span> Automated workflows with Agent mode<a href="automated-workflows-with-agent-mode.html#automated-workflows-with-agent-mode" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Agents are LLMs that have tools that allow them to work autonomously. In effect they review the results of tool use (such as writing code and running code), then respond to those results.</p>
<p>In Copilot’s chat window you can set it to ‘Agent’ mode to enable these features.</p>
<p>After each tool use copilot will ask you to confirm the changes and the next action. At that point you can review its changes, make edits, or continue chatting to suggest refinements.</p>
<p><img src="https://code.visualstudio.com/assets/blogs/2025/02/24/diagram.png" /></p>
<p>Agent mode has access to the terminal, so it will be using the terminal application to run scripts it creates. We’ll demonstrate in class so you can understand what its doing.</p>
<p><strong>Image:</strong> Agent mode from <a href="https://code.visualstudio.com" class="uri">https://code.visualstudio.com</a></p>
<p>You can also just accept every suggestion without reading it, also called ‘vibe coding’. However, I don’t recommend doing that, especially when you are starting out. You need to get a feel of how much direction it needs and problems it might create. Without human intervention the algorithms have a tendency to go off task:</p>
<pre><code>## Warning: Using `size` aesthetic for lines was deprecated in ggplot2 3.4.0.
## ℹ Please use `linewidth` instead.
## This warning is displayed once every 8 hours.
## Call `lifecycle::last_lifecycle_warnings()` to see where this warning was generated.</code></pre>
<p><img src="_main_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
<p>Have a readme with clear steps that you attach as a prompt is also helpful for Agent mode. It helps it stay on topic.</p>
<p>Agent mode also allows installation of additional tools, which we’ll explore later.</p>
<div id="exploring-agent-mode" class="section level2 hasAnchor" number="9.1">
<h2><span class="header-section-number">9.1</span> Exploring agent mode<a href="automated-workflows-with-agent-mode.html#exploring-agent-mode" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s explore Agent mode’s features through some analysis.</p>
<div id="motivating-example-bayesian-time-series-analysis" class="section level3 hasAnchor" number="9.1.1">
<h3><span class="header-section-number">9.1.1</span> Motivating example Bayesian time-series analysis<a href="automated-workflows-with-agent-mode.html#motivating-example-bayesian-time-series-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We’ll develop time-series models to forecast rock lobster (<em>Jasus edwardsii</em>) abundance from annual diver surveys. I’ve provided you with summary data. If you want to use this data in your research it is freely available and the original should be downloaded from <a href="https://portal.aodn.org.au/">the AODN portal</a>.</p>
<p>We’ll use the <a href="https://www.r-inla.org/">INLA package</a> for our time-series models. We’ll fit it for the first part of the data, then we’ll forecast to the last part. In this way we can test the model’s predictions against data that is independent of model fitting (validation).</p>
<p><a href="https://www.biorxiv.org/content/10.1101/2025.01.23.634630v1.abstract">The example is based on my study where I asked how accurately we can forecast species abundance change in dynamic environment</a>. In a rapidly changing environment the models we fit to historical data may no longer make accurate predictions to future, novel, environments. So our current models may overstate the future predictability of ecosystems.</p>
<p>In short, the environments we want to predict to in the future have no analogue in contemporary data. This may make accurate prediction more challenging.</p>
<p>To explore this idea I developed a new way of validating time-series. I deliberately designed validations that forced the model fitting to be to older data and the forecasting and accuracy evaluation to be on contemporary data. As such, if the environment has changed the parameters the model has learned from the historical data will no longer be relevant in the contemporary environment.</p>
<p>We found the new method gave much more pessimistic estimates of model accuracy for species that undergo rapid changes. Whereas for species that have resisted environmental change the new method gave comparable results to traditional methods of validation.</p>
<p>In today’s workshop we’ll look at the first step, which is how to fit a model and make forecasts.</p>
<p>We chose Bayesian models with INLA because have several advantages over alternatives:</p>
<ol style="list-style-type: decimal">
<li><p>Allow for complex heirarchical models in a familiar GLMM framework - we have structuring by time and sites to consider</p></li>
<li><p>Are computationally fast to run - convenient if you are re-running the model to do cross validation.</p></li>
<li><p>Automatically handles gaps in time-series - Our data has a gap in 2003 when funding for monitoring wasn’t available</p></li>
<li><p>Straightforward to model non-normal data - we are using counts.</p></li>
</ol>
<p>We’ll use INLA to fit auto-regressive order 1 (AR1) models to rock lobster abundance, with a negative binomial distribution. We’ll also use INLA to make forecasts.</p>
<p>Another nice thing about INLA for us is that it has an unusual way of implementing predictions. This tends to trip-up copilot, so we’ll see how to overcome that challenge and get copilot to write correct code.</p>
</div>
<div id="set-up-your-project" class="section level3 hasAnchor" number="9.1.2">
<h3><span class="header-section-number">9.1.2</span> Set-up your project<a href="automated-workflows-with-agent-mode.html#set-up-your-project" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Set-up a new project, including creating a readme following the structure we used before.</p>
<p>Here’s the link to the data:</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="automated-workflows-with-agent-mode.html#cb32-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb32-2"><a href="automated-workflows-with-agent-mode.html#cb32-2" tabindex="-1"></a>dat <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="fu">url</span>(<span class="st">&quot;https://raw.githubusercontent.com/cbrown5/R-llm-workshop/refs/heads/main/resources/ATRC-RLS-jasus-edwardsii-maria-island.csv&quot;</span>))</span></code></pre></div>
<p><a href="https://github.com/cbrown5/R-llm-workshop/tree/main/resources/forecasting-with-inla">You can see the readme.md I used to get started here</a>. I encourage you to write your own to get a feel for how it works and develop your own style.</p>
</div>
<div id="prompts-i-used" class="section level3 hasAnchor" number="9.1.3">
<h3><span class="header-section-number">9.1.3</span> Prompts I used<a href="automated-workflows-with-agent-mode.html#prompts-i-used" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Once I had the folder and readme set-up here’s the series of prompts I used. I encourage you to explore making your own.
I used Claude 4.0 as the model option. I’ve found that GPT occaisonally makes errors with tool use or stuffs up text matching when editing files (meaning it inserts text in the wrong place).</p>
<p>I started a new chat session between each of these prompts. This helps manage the context window. I’m relying on updating the readme.md so Copilot has memory (and I get it to update that).</p>
<pre><code>Start by documenting the directory structure in the readme.md</code></pre>
<pre><code>I&#39;d be most pleased if you can undertake to perform steps 1-2. Document the data variables in the readme when you are done. </code></pre>
<div class="tip">
<p><strong>Tip:</strong> There’s no ‘optimal’ prompt, only better prompts. Sometimes the best way to write is the way you are most comfortable writing. You’ll get more out of your brain that way and copilot will end up performing the same.</p>
</div>
<pre><code>Ahoy you salty sea dog, we&#39;ve scrubbed down steps 1 and 2, time for you to raise the sail on step 3!</code></pre>
<p>(Ok so that last prompt definitely doesn’t follow the guidelines of being super clear, but I was bored and it seemed to work ok)</p>
<p>It wrote some nice code for step 3, but had some problems with model convergence. At this point I intervened manually and edited the model myself. I didn’t really want it deciding the model structure for me, as I knew what I wanted (below is the model I used FYI). That fixed it and I got it to document the changes then started a new chat.</p>
<p>Note that the Agent changed the default fitting algorithm, which I wasn’t pleased with. So always important to check the details.</p>
<pre><code>simple_model_formula &lt;- total_lobsters ~ 1 + 
  protection_status +
  f(site_numeric, model = &quot;iid&quot;) +
  f(year, model = &quot;ar1&quot;, hyper = ar1_prior)

ar1_model &lt;- inla(
  formula = simple_model_formula,
  data = train_data,
  family = &quot;nbinomial&quot;,  # Use negative binomial for count data
  control.predictor = list(compute = TRUE),
  control.compute = list(
    dic = TRUE, 
    waic = TRUE,
    cpo = FALSE,  # Disable CPO to help convergence
    config = FALSE
  ),
  verbose = FALSE
)</code></pre>
<p>After fixing the model and updated the readme, here’s the next step:</p>
<pre><code>Alright cobber, take you best shot at step 4</code></pre>
<p>That worked, which actually I was expecting it not to work based on prior experience. <a href="https://www.r-inla.org/faq#h.821k2r53fvx3">INLA does predictions as part of model fitting, so you can’t <code>predict(model1)</code> like you can with other packages.</a>. I’ve found that often trips up copilot when it tries to predict directly from the model object. It might be that Claude 4.0 (only came out as I was writing this) now ‘knows’ not to make that mistake.</p>
<p>I tried again with Claude 3.5 (older version) to see if I could fool that one. However, it avoided the problem by writing a custom fitting function (which would need careful checking).</p>
<p>Anyway, the lesson was meant to be to show you how to solve these types of problems by attaching domain knowledge like the FAQ linked above.</p>
<p>Copilot agent did have some problems running Rscript on my computer (used to source R files from terminal). So I added this line to the readme to help it: When using Rscript from terminal be sure to put the script in ““, e.g. <code>Rscript "Scripts/script1.R"</code></p>
<pre><code>Just step 5 left to go, make me some nice plots using the types of colours that Wes Anderson would choose</code></pre>
</div>
<div id="writing-up-the-project" class="section level3 hasAnchor" number="9.1.4">
<h3><span class="header-section-number">9.1.4</span> Writing up the project?<a href="automated-workflows-with-agent-mode.html#writing-up-the-project" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>You can keep going from here if you like and get agent mode to write up the results it found as an Rmd file. It will use the tables it generates to (hopefully) make accurate interpretations. Pretty soon Copilot will also have vision capabilities (currently available in preview mode as of 2025-05-27). This means it will be able to interpret the figures it creates as well. We’ll see that in action when we look at Roo Code in a bit.</p>
<p>If you do that, as always, don’t take anything for granted. Make sure you check everything and understand the results yourself.</p>
</div>
<div id="custom-intstructions" class="section level3 hasAnchor" number="9.1.5">
<h3><span class="header-section-number">9.1.5</span> Custom intstructions<a href="automated-workflows-with-agent-mode.html#custom-intstructions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For heavy agent use you may want to set-up custom instructions. These apply to all prompts in a project. e.g. you could set preference for ggplot2, or tell it how to use Rscript to avoid terminal errors <a href="https://docs.github.com/en/copilot/customizing-copilot/adding-repository-custom-instructions-for-github-copilot">See here for instructions</a>.</p>
</div>
</div>
<div id="summary-1" class="section level2 hasAnchor" number="9.2">
<h2><span class="header-section-number">9.2</span> Summary<a href="automated-workflows-with-agent-mode.html#summary-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Agent mode can really accelerate your workflow development. But there are some risks. It can also go off track or write excessive amounts of code (over-engineering). Best practices for using Agent mode include:</p>
<ul>
<li>Separate science questions (what stats) from implementation stats (what code)</li>
<li>Understand the stats you want to do, don’t just rely on copilot to get it right</li>
<li>Checking what it does at is does it, so you can keep it on track</li>
<li>Giving strong guidelines e.g. through a project readme file.</li>
<li>Keeping the readme updated to guide copilot</li>
<li>Report AI use and how it was used in your publications</li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="creating-your-code-with-edit-mode.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ethics-and-copyright.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/08-agent-mode.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
